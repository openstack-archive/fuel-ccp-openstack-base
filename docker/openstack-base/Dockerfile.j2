FROM {{ image_spec("base-tools") }}
MAINTAINER {{ maintainer }}

RUN apt-get install -y --no-install-recommends \
        build-essential \
        python-dev \
        libssl-dev \
        libmysqlclient-dev \
        libxslt1-dev \
        libffi-dev \
        libyaml-dev \
        pkg-config \
        git \
    && apt-get clean

COPY {{ render('pip.conf.j2') }} /tmp/pip.conf

{{ copy_sources("openstack/requirements", "/tmp/requirements") }}

RUN pip --no-cache-dir install -U virtualenv \
    && virtualenv /var/lib/microservices/venv \
    && mv /tmp/requirements/upper-constraints.txt /var/lib/microservices/venv/constraints.txt \
    && mv /tmp/pip.conf /var/lib/microservices/venv \
    && /var/lib/microservices/venv/bin/pip install --upgrade \
        Babel \
        Mako \
        MarkupSafe \
        Paste \
        PasteDeploy \
        PyYAML \
        Routes \
        SQLAlchemy \
        Tempita \
        WebOb \
        alembic \
        amqp \
        anyjson \
        appdirs \
        cachetools \
        cliff \
        cmd2 \
        contextlib2 \
        debtcollector \
        decorator \
        enum34 \
        eventlet \
        fasteners \
        funcsigs \
        functools32 \
        futures \
        futurist \
        greenlet \
        iso8601 \
        jinja2 \
        jsonpatch \
        jsonpointer \
        jsonschema \
        keystoneauth1 \
        keystonemiddleware \
        kombu \
        monotonic \
        msgpack-python \
        netaddr \
        netifaces \
        os-client-config \
        oslo.concurrency \
        oslo.config \
        oslo.context \
        oslo.db \
        oslo.i18n \
        oslo.log \
        oslo.messaging \
        oslo.middleware \
        oslo.policy \
        oslo.serialization \
        oslo.service \
        oslo.utils \
        pbr \
        pika \
        pika-pool \
        positional \
        prettytable \
        pycadf \
        pycrypto \
        pyinotify \
        pymysql \
        pyparsing \
        python-barbicanclient \
        python-ceilometerclient \
        python-cinderclient \
        python-congressclient \
        python-dateutil \
        python-designateclient \
        python-editor \
        python-glanceclient \
        python-heatclient \
        python-ironicclient \
        python-keystoneclient \
        python-magnumclient \
        python-manilaclient \
        python-memcached \
        python-mistralclient \
        python-muranoclient \
        python-neutronclient \
        python-novaclient \
        python-openstackclient \
        python-saharaclient \
        python-swiftclient \
        python-troveclient \
        python-tuskarclient \
        python-zaqarclient \
        pytz \
        pyzmq \
        redis \
        repoze.lru \
        requests \
        requestsexceptions \
        retrying \
        simplejson \
        six \
        sqlalchemy-migrate \
        sqlparse \
        stevedore \
        unicodecsv \
        warlock \
        wrapt \
    && rm -rf /tmp/requirements

ENV PATH /var/lib/microservices/venv/bin:$PATH
